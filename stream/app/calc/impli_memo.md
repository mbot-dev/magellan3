### 処方
#### 単位換算 A%Bml=A%Bml×10=mg
#### 1剤、1回分、1調剤
 * 内服薬の1剤 
   - ① 1回の処方で2種類以上の内服薬を調剤する場合は、服用時点および服用回数が同じであるものは1剤として算定します。
   - ② 服用時点、服用回数が同じでも、処方日数が異なる場合は、別剤として別個に算定します。
 * 屯服薬の1回分
   - 目的が別のもの（鎮痛剤と下剤等）は、それぞれ別剤として別個に算定します。
 * 外用薬の1調剤 
   - ① 外用薬の場合、1調剤とは1回の調剤分の全量のことを言います。
   - 例えばトローチを1日4 錠、4日分を投与した場合、4錠×4日＝16錠が1調剤となり、16錠分の薬価を算定し、○点×「1」とします。
   - ② 外用薬は1剤ごとに目的も服用方法も違うので、2種類の薬を調合されていない限り、1つ1つ別に算定します。
#### 薬剤料 ＋ 調剤料 ＋ 処方料 ＋（乳幼児加算）＋（特定疾患処方管理加算）＋（麻毒加算）＋（調剤技術基本料）
#### 薬剤料: 五捨五超入 15円以下の薬剤は1点
#### 内服薬 1単位= 1剤1日分
#### 屯服薬 1単位= 1回分
#### 外用薬 1単位= 1調剤（処方された薬の全量）
#### 内服:
  * 同一用法（服薬のタイミングが同じ）・同一日数単位にバンドルを作る -> 1剤単位
  * バンドル内の薬剤料（単価x1日量）を合計　15円以下は1点、超える場合は10で割り5捨5超入 -> 点数
  * 点数 x 日数  ex. 50点x14単位
  * 内服 = bundle.get('oral')
  * 日数 = bundle.get('quantity')
  * 1日量 = item.get('quantity')
#### 屯服:
  * 目的が違うもの（同一用法）単位にバンドルを作る
  * バンドル内の1回分の薬剤料を合計して10で割り、5捨5超入 -> 点数
  * 点数 x 回数  ex. 50点x14回
  * 頓服 = bundle.get('oral')
  * 回数 = bundle.get('quantity')
  * 1回量 = item.get('quantity')
#### 外用:
  * 外用薬は1剤ごとに目的も服用方法も違うのでこれをバンドルにする
  * 1調剤=全量
  * 全量点数 x 1
  * 外用 = bundle.get('topical')
  * 回数 = bundle.get('quantity') == 1
  * 全量 = item.get('quantity')
#### 処方料、処方箋料、調剤料等は 800 

### 処置
#### バンドル=(手技+医薬品+特定器材+コメント)
  * コメント　右肘関節部挫傷 890000001 ２０５６１６６０２０５９
  * コメント　右肩関節部脱臼 890000001 ２０５６１６１５２０５９
  * 両側が原則
  * （片側）とある処置を両側に行なった場合　xxx 右、xxx 左と別々に算定する
  * 所定点数 = 注加算を含む 150点以上は時間外加算2
  * 酸素（単価 x 使用量 x 補正率）
  * 6L x 5H x 60分 = 1800L
  * 0.19円 x 1800L x 1.3 = 444.6 -> 445円
  * 445 / 10 = 44.5 -> 45円
  * 酸素は!薬剤 -> 手技へ
  * 手術当日の処置は算定不可（ギプスを除く）
  * 処置医療機器加算
  * 腰部胸部頸部　固定帯加算　初回のみ
  * 酸素加算
  * 1回目の四捨五入（酸素の単価=購入価格 x 使用量 x 補正率）
  * 2回目の四捨五入(1回目/10)
  * 酸素は薬剤ではない
  * 窒素　= 四捨五入（窒素の単価=購入価格 x 使用量 /10）
  * 創傷処置　要部位
  * 初回処置の月日
  * ネブライザ注射薬　アンプルでも比例計算



### 画像
#### 点数
 *  診断料（基）+ 撮影料（基）-> 撮影料に合計点数 -> normalize で OK
#### 数量
 * 数量 = フィルム枚数 | 撮影回数
   - 大角1枚使用 -> 診断料=1枚　撮影料=1枚
   - 四つ切り（２分割）1枚使用　-> 診断料=2枚　撮影料=2枚
   - 他医撮影の写真診断（単純イ）+ 他医撮影の写真診断（特殊撮影） -> フィルム枚数に関わらず1 -> 記録しない -> 刻み以外は表示しない
   - 両方とも準用項目でそれぞれに点数を記録している ->  ToDo バンドルを別ける 診療識別子が新たにつく　コメントが二つ  同一部位　異なる部位はOK
   - ToDo 診断、撮影とも複数セットできないようにしたらどうか
  * 同一部位に同時に二つ以上のX線撮影を行った場合
   - 最初の方法:単純^アナログ^グフィルム枚数=1　2回目の方法:造影剤^造影剤アナログ^フィルム枚数=4^造影剤注入手技^造影剤
   - 画像関係の数量=1, 4
   - 画像関係の点数はまとめている
   - 造影剤注入手技の点数は独立
   - フィルムは別々に1 & 4
   - 造影剤点数

### コメント
##### 自動挿入
 * リストアップする
 * 二つ目の診療科
 * 包括検査の名前と項目数
 * 外来迅速検査数　外来診療料を算定した場合に要コメント
 * 入院は除外
##### 部位
 * 撮影部位メニューとして独立 82 83 89
 * 処置 89
##### 修飾語
 * 89 右肘関節部　205616602059 -> 右2056　肘関節1660 部2059  4,8,12桁あり
##### UI対応
 * UIを提供することで自動化できないものをカバーしている
 * コメントは独立させ、バンドルに組み合わせる方法を考える　編集も必要
 * 部位等を組み合わせたスタンプは数が多くなる
 * 入力データによる分類（理由 初回年月日 項目数...）?
 * コメント文をそのまま表示 82
 * 任意の文字列を記録 81
 * コメント文は編集させないで、データを入力　表示は連結または埋め込みでCSVにはデータのみ全角で記録
 * 元号が必要
 * 修飾語コード...89  右肘関節部　205616602059 右肩関節部205616152059　右2056　肘関節1660 部2059
 * 撮影部位 82　83 89
  - 81  任意の文字列を記録                           810000001   術前検査 -> 810000001,術前検査
  - 82  コメントをそのまま表示                       820000006   健康診断から -> 820000006,
  - 83  コメントの後に追加                           830100060   検査名(悪性腫瘍特異物質治療管理料);CEA -> 830100060, CEA（全角）
  - 831 コメントの後に診療行為コードを翻訳して追加       831110002   入院後3日以内に実施した主要な診療行為;酸素吸入 -> 831110002,140005610（診療行為コード全角）
  - 84  コメント文にデータを埋め込み                  840000513 　退 院 令和 4年 7月 2日 -> 840000513,5040702（全角）
  - 842 コメント文の後に数字を記録                    842100057 　通算実施回数(持続緩徐式血液濾過);3　-> 842100057,3（全角）       
  - 85  コメント文の後に年月日を付加                  850100186  算定開始年月日(呼吸心拍監視等);令和 4年 7月12日 -> 850100186,5040712（全角）
  - 851 コメント文の後に時分を付加                    851100004  検査開始時刻(時間外緊急院内検査加算);23時 5分 -> 851100004,2305（全角）
  - 852 コメント文の後に分を付加                    852100007 診療時間(通院・在宅精神療法);   75分 -> 852100007,00075（全角 ５桁で表示）
  - 853 コメント文の後に日時分を付加                 853100007 手術を開始した日時(緊急整復固定加算); 1日12時15分 -> 853100007,011215（全角）
  - 880 コメント文の後に年月日と検査値を付加　　　　　　880100013　検査の実施年月日及び検査結果(フェリチン);令和 4年10月 5日　検査値:10 -> 880100013,504100500000010（全角）年月日情報をGYYMMDD形式(全角数字)、値を8桁(頭0埋め)の計15桁
  - 89  医療機関が記録した修飾語コードを翻訳して表示する 890000001 右手第1指 -> 890000001,205610451035（全角）

##### ルールを書けば拡張できる
 * 点数区分 診療行為 コメントコード コメントデータ（診療科 項目数 初回年月日 開始時間 実施日等） 記録方法（文字列埋め込み...）
 * 理由を書くのは無理
 * 頭からInjectionして行く
 * 入院は除外
 * Z3 整数で起動する関数の名前を指定する
  - If(And(...), 5, 0)  -> rule-5 をinvoke  0はしない
##### 例
 * 111011810    830100002 2つ目の診療科(初診料);{dept} 置換 内科
 * 丸め算定区分-2 810000001 内分泌学的検査{cnt}項目 置換 4
 * 
